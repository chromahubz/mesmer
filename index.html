<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesmer - Generative Audiovisual Engine</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Dual-layer canvas system -->
        <canvas id="mainCanvas"></canvas>
        <canvas id="toyCanvas"></canvas>

        <!-- Debug Overlay -->
        <div id="debugOverlay" style="position: fixed; bottom: 20px; left: 20px; background: rgba(0,0,0,0.9); color: #0f0; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 11px; z-index: 1000; max-width: 300px; border: 2px solid #0f0;">
            <div style="font-weight: bold; margin-bottom: 10px; color: #ff0;">MESMER DEBUG</div>
            <div id="debugContent">Initializing...</div>
            <button onclick="document.getElementById('debugOverlay').style.display='none'" style="margin-top: 10px; padding: 5px 10px; background: #f00; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 10px;">Hide</button>
        </div>

        <!-- Shader Editor Panel (Left Side) -->
        <div class="shader-editor-left collapsed" id="shaderEditorLeft">
            <div class="editor-header">
                <h3>
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                    </svg>
                    Shader Editor
                </h3>
                <button id="toggleEditorLeft" class="btn-icon">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                    </svg>
                </button>
            </div>

            <div class="editor-content" id="editorContentLeft">
                <div class="editor-toolbar">
                    <div class="format-toggle">
                        <button id="formatGLSL" class="format-btn active">GLSL</button>
                        <button id="formatShaderToy" class="format-btn">ShaderToy</button>
                    </div>
                    <div class="target-layer">
                        <label>Target:</label>
                        <select id="targetLayer">
                            <option value="main">Main Layer</option>
                            <option value="toy">ShaderToy Layer</option>
                        </select>
                    </div>
                </div>

                <div class="editor-helper">
                    <span class="helper-text">Paste GLSL or ShaderToy code below</span>
                    <div class="helper-buttons">
                        <button id="copyCodeBtn" class="btn-mini" title="Copy code">
                            <svg class="icon-mini" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                            </svg>
                        </button>
                        <button id="pasteCodeBtn" class="btn-mini" title="Paste from clipboard">
                            <svg class="icon-mini" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="editor-textarea-wrapper">
                    <textarea id="shaderCode" class="shader-code" spellcheck="false" placeholder="// Paste your shader code here..."></textarea>
                    <div class="editor-line-numbers" id="lineNumbers"></div>
                </div>

                <div class="editor-controls">
                    <button id="compileBtn" class="btn-primary">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        Compile & Run
                    </button>
                    <button id="loadPresetBtn" class="btn-secondary">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        Presets
                    </button>
                    <button id="clearBtn" class="btn-secondary">Clear</button>
                </div>

                <div class="editor-status" id="editorStatus">
                    <span class="status-text">Ready</span>
                </div>

                <!-- Preset Library Modal -->
                <div class="preset-modal" id="presetModal" style="display: none;">
                    <div class="preset-modal-content">
                        <div class="preset-modal-header">
                            <h3>Shader Presets</h3>
                            <button id="closePresetModal" class="btn-icon">
                                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="preset-grid" id="presetGrid">
                            <!-- Presets will be dynamically loaded -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Drum Sequencer Panel -->
        <div class="drum-sequencer" id="drumSequencer" style="display: none;">
            <div class="sequencer-header" id="sequencerHeader">
                <h3>ü•Å DRUM SEQUENCER</h3>
                <div style="display: flex; gap: 10px;">
                    <button id="toggleSequencerBtn" class="btn-icon" title="Collapse/Expand">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                        </svg>
                    </button>
                    <button id="closeDrumSequencer" class="btn-icon">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="sequencer-controls">
                <div class="drum-channel" data-drum="kick">
                    <div class="channel-header">
                        <span class="channel-name">KICK</span>
                        <input type="range" class="drum-volume" min="0" max="100" value="100" data-channel="kick">
                        <span class="volume-value">100</span>
                    </div>
                    <div class="step-grid">
                        <!-- 16 steps will be created dynamically -->
                    </div>
                </div>

                <div class="drum-channel" data-drum="snare">
                    <div class="channel-header">
                        <span class="channel-name">SNARE</span>
                        <input type="range" class="drum-volume" min="0" max="100" value="80" data-channel="snare">
                        <span class="volume-value">80</span>
                    </div>
                    <div class="step-grid">
                        <!-- 16 steps will be created dynamically -->
                    </div>
                </div>

                <div class="drum-channel" data-drum="hihat">
                    <div class="channel-header">
                        <span class="channel-name">HI-HAT</span>
                        <input type="range" class="drum-volume" min="0" max="100" value="60" data-channel="hihat">
                        <span class="volume-value">60</span>
                    </div>
                    <div class="step-grid">
                        <!-- 16 steps will be created dynamically -->
                    </div>
                </div>

                <div class="drum-channel" data-drum="openhat">
                    <div class="channel-header">
                        <span class="channel-name">OPEN HAT</span>
                        <input type="range" class="drum-volume" min="0" max="100" value="50" data-channel="openhat">
                        <span class="volume-value">50</span>
                    </div>
                    <div class="step-grid">
                        <!-- 16 steps will be created dynamically -->
                    </div>
                </div>

                <div class="master-controls">
                    <label>
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                        </svg>
                        MASTER DRUM VOLUME
                    </label>
                    <input type="range" id="drumMasterVolume" min="0" max="100" value="100">
                    <span class="value" id="drumMasterValue">100%</span>
                </div>
            </div>
        </div>

        <!-- UI Controls -->
        <div id="controls">
            <div class="control-panel">
                <div class="brand">
                    <h1>MESMER</h1>
                    <p class="tagline">Generative Audiovisual Engine</p>
                </div>

                <div class="control-group">
                    <h3>Audio</h3>
                    <button id="playBtn" class="btn-primary">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <span>Play</span>
                    </button>
                    <div class="slider-group">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                            </svg>
                            Synth Volume
                        </label>
                        <input type="range" id="synthVolumeSlider" min="0" max="100" value="70">
                        <span class="value">70%</span>
                    </div>
                    <div class="slider-group">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h2v2H7zm8 0h2v2h-2zm-4 0h2v2h-2z"/>
                            </svg>
                            Drum Volume
                        </label>
                        <input type="range" id="drumVolumeSlider" min="0" max="100" value="70">
                        <span class="value">70%</span>
                    </div>
                    <div class="slider-group">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/>
                            </svg>
                            Reverb
                        </label>
                        <input type="range" id="reverbSlider" min="0" max="100" value="30">
                        <span class="value">30%</span>
                    </div>
                    <div class="slider-group">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 1v8l6-6-6-2zm0 10v10l10-10H12zM2 12h10L2 22V12z"/>
                            </svg>
                            Delay
                        </label>
                        <input type="range" id="delaySlider" min="0" max="100" value="20">
                        <span class="value">20%</span>
                    </div>
                    <div class="slider-group">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 3v15h3V3H9zm-4 2v11h3V5H5zm8 5v6h3v-6h-3zm4-3v9h3V7h-3z"/>
                            </svg>
                            BPM
                        </label>
                        <input type="range" id="bpmSlider" min="40" max="180" value="80">
                        <span class="value">80</span>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                            </svg>
                            Music Genre
                        </label>
                        <select id="genreSelect">
                            <optgroup label="Electronic">
                                <option value="ambient">Ambient</option>
                                <option value="techno">Techno</option>
                                <option value="house">House</option>
                                <option value="trance">Trance</option>
                                <option value="dnb">Drum & Bass</option>
                                <option value="dubstep">Dubstep</option>
                                <option value="industrial">Industrial</option>
                                <option value="idm">IDM</option>
                                <option value="breakbeat">Breakbeat</option>
                                <option value="jungle">Jungle</option>
                                <option value="garage">UK Garage</option>
                                <option value="bassline">Bassline</option>
                                <option value="grime">Grime</option>
                                <option value="footwork">Footwork/Juke</option>
                            </optgroup>
                            <optgroup label="Retro/Wave">
                                <option value="synthwave">Synthwave</option>
                                <option value="vaporwave">Vaporwave</option>
                                <option value="chillwave">Chillwave</option>
                            </optgroup>
                            <optgroup label="Hip-Hop & Urban">
                                <option value="hiphop">Hip-Hop</option>
                                <option value="trap">Trap</option>
                                <option value="lofi">Lo-Fi Hip-Hop</option>
                                <option value="triphop">Trip-Hop</option>
                            </optgroup>
                            <optgroup label="Jazz & Funk">
                                <option value="jazz">Jazz</option>
                                <option value="funk">Funk</option>
                                <option value="soul">Soul</option>
                            </optgroup>
                            <optgroup label="Chill & Downtempo">
                                <option value="chillout">Chillout</option>
                                <option value="downtempo">Downtempo</option>
                            </optgroup>
                            <optgroup label="Experimental">
                                <option value="drone">Drone</option>
                                <option value="psychedelic">Psychedelic</option>
                                <option value="experimental">Experimental</option>
                                <option value="minimal">Minimal</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            Music Mode
                        </label>
                        <div class="mode-toggle">
                            <button id="generativeModeBtn" class="mode-btn active">
                                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M7.5 5.6L10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29c-.39-.39-1.02-.39-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41l-2.33-2.35zm-1.03 5.49l-2.12-2.12 2.44-2.44 2.12 2.12-2.44 2.44z"/>
                                </svg>
                                Generative
                            </button>
                            <button id="prodModeBtn" class="mode-btn">
                                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                                </svg>
                                Prod/DAW
                            </button>
                        </div>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                            </svg>
                            Synth Engine
                        </label>
                        <select id="synthEngineSelect">
                            <option value="tonejs" selected>Tone.js (Classic)</option>
                            <option value="wad">WAD (Sound Banks)</option>
                            <option value="dirt">Dirt (Samples)</option>
                        </select>
                    </div>
                    <div class="shader-selector wad-controls" style="display: none;">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                            </svg>
                            Pad Sound
                        </label>
                        <select id="wadPadPreset">
                            <option value="warmPad" selected>Warm Pad</option>
                            <option value="spacePad">Space Pad</option>
                            <option value="dreamPad">Dream Pad</option>
                            <option value="atmosphericPad">Atmospheric</option>
                            <option value="drone">Drone</option>
                        </select>
                    </div>
                    <div class="shader-selector wad-controls" style="display: none;">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                            </svg>
                            Lead Sound
                        </label>
                        <select id="wadLeadPreset">
                            <option value="brightLead" selected>Bright Lead</option>
                            <option value="analogLead">Analog Lead</option>
                        </select>
                    </div>
                    <div class="shader-selector wad-controls" style="display: none;">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                            </svg>
                            Bass Sound
                        </label>
                        <select id="wadBassPreset">
                            <option value="deepBass" selected>Deep Bass</option>
                            <option value="subBass">Sub Bass</option>
                            <option value="acidBass">Acid Bass</option>
                        </select>
                    </div>
                    <div class="shader-selector dirt-controls" style="display: none;">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                            </svg>
                            Pad Samples
                        </label>
                        <select id="dirtPadBank">
                            <optgroup label="Pads & Ambient">
                                <option value="breath">Breath</option>
                                <option value="cosmicg">Cosmicg</option>
                                <option value="feel">Feel</option>
                                <option value="feelfx">Feelfx</option>
                                <option value="moog">Moog</option>
                                <option value="newnotes">Newnotes</option>
                                <option value="notes">Notes</option>
                                <option value="outdoor">Outdoor</option>
                                <option value="pad" selected>Pad</option>
                                <option value="padlong">Padlong</option>
                                <option value="psr">PSR</option>
                                <option value="seawolf">Seawolf</option>
                                <option value="space">Space</option>
                                <option value="sugar">Sugar</option>
                                <option value="wind">Wind</option>
                            </optgroup>
                            <optgroup label="Bass">
                                <option value="bass">Bass</option>
                                <option value="bass0">Bass 0</option>
                                <option value="bass1">Bass 1</option>
                                <option value="bass2">Bass 2</option>
                                <option value="bass3">Bass 3</option>
                                <option value="bassfoo">Bassfoo</option>
                                <option value="db">Double Bass</option>
                                <option value="dorkbot">Dorkbot</option>
                                <option value="jungbass">Jungle Bass</option>
                                <option value="jvbass">JV Bass</option>
                                <option value="subroc3d">Subroc3D</option>
                                <option value="wobble">Wobble</option>
                            </optgroup>
                            <optgroup label="Leads & Melodic">
                                <option value="arpy">Arpy</option>
                                <option value="bleep">Bleep</option>
                                <option value="gtr">Guitar</option>
                                <option value="hoover">Hoover</option>
                                <option value="monsterb">Monsterb</option>
                                <option value="oc">OC</option>
                                <option value="popkick">Popkick</option>
                                <option value="sax">Sax</option>
                                <option value="simplesine">Simple Sine</option>
                                <option value="trump">Trumpet</option>
                                <option value="ul">UL</option>
                            </optgroup>
                            <optgroup label="Plucks & Keys">
                                <option value="arp">Arp</option>
                                <option value="blip">Blip</option>
                                <option value="bottle">Bottle</option>
                                <option value="casio">Casio</option>
                                <option value="click">Click</option>
                                <option value="jazz">Jazz</option>
                                <option value="juno">Juno</option>
                                <option value="peri">Peri</option>
                                <option value="pluck">Pluck</option>
                                <option value="print">Print</option>
                                <option value="sitar">Sitar</option>
                                <option value="stab">Stab</option>
                            </optgroup>
                            <optgroup label="Percussion">
                                <option value="can">Can</option>
                                <option value="glasstap">Glasstap</option>
                                <option value="hand">Hand</option>
                                <option value="lighter">Lighter</option>
                                <option value="metal">Metal</option>
                                <option value="perc">Perc</option>
                                <option value="stomp">Stomp</option>
                                <option value="tabla">Tabla</option>
                                <option value="tabla2">Tabla 2</option>
                                <option value="tablex">Tablex</option>
                                <option value="tink">Tink</option>
                                <option value="tok">Tok</option>
                            </optgroup>
                            <optgroup label="Drums & Breaks">
                                <option value="amencutup">Amen Cutup</option>
                                <option value="bd">Bass Drum</option>
                                <option value="breaks125">Breaks 125</option>
                                <option value="clubkick">Club Kick</option>
                                <option value="cp">Clap</option>
                                <option value="dr55">DR-55</option>
                                <option value="drum">Drum</option>
                                <option value="drumtraks">Drumtraks</option>
                                <option value="gretsch">Gretsch</option>
                                <option value="hardkick">Hard Kick</option>
                                <option value="hh">Hi-hat</option>
                                <option value="hh27">Hi-hat 27</option>
                                <option value="jungle">Jungle</option>
                                <option value="kicklinn">Kick Linn</option>
                                <option value="linnhats">Linn Hats</option>
                                <option value="reverbkick">Reverb Kick</option>
                                <option value="sd">Snare Drum</option>
                                <option value="sn">Snare</option>
                            </optgroup>
                            <optgroup label="Electronic & Synth">
                                <option value="auto">Auto</option>
                                <option value="electro1">Electro 1</option>
                                <option value="em2">EM2</option>
                                <option value="fm">FM</option>
                                <option value="future">Future</option>
                                <option value="gabba">Gabba</option>
                                <option value="gabbaloud">Gabba Loud</option>
                                <option value="gabbalouder">Gabba Louder</option>
                                <option value="hardcore">Hardcore</option>
                                <option value="house">House</option>
                                <option value="rave">Rave</option>
                                <option value="rave2">Rave 2</option>
                                <option value="ravemono">Rave Mono</option>
                                <option value="sequential">Sequential</option>
                                <option value="sid">SID</option>
                                <option value="tech">Tech</option>
                                <option value="techno">Techno</option>
                            </optgroup>
                            <optgroup label="Vocals & Speech">
                                <option value="alphabet">Alphabet</option>
                                <option value="diphone">Diphone</option>
                                <option value="diphone2">Diphone 2</option>
                                <option value="haw">Haw</option>
                                <option value="hmm">Hmm</option>
                                <option value="ho">Ho</option>
                                <option value="miniyeah">Mini Yeah</option>
                                <option value="mouth">Mouth</option>
                                <option value="num">Num</option>
                                <option value="numbers">Numbers</option>
                                <option value="speakspell">Speak & Spell</option>
                                <option value="speech">Speech</option>
                                <option value="speechless">Speechless</option>
                                <option value="yeah">Yeah</option>
                            </optgroup>
                            <optgroup label="FX & Glitch">
                                <option value="bend">Bend</option>
                                <option value="control">Control</option>
                                <option value="dist">Distortion</option>
                                <option value="flick">Flick</option>
                                <option value="foo">Foo</option>
                                <option value="gab">Gab</option>
                                <option value="glitch">Glitch</option>
                                <option value="glitch2">Glitch 2</option>
                                <option value="if">If</option>
                                <option value="ifdrums">If Drums</option>
                                <option value="industrial">Industrial</option>
                                <option value="mute">Mute</option>
                                <option value="noise">Noise</option>
                                <option value="noise2">Noise 2</option>
                                <option value="off">Off</option>
                                <option value="proc">Proc</option>
                                <option value="procshort">Proc Short</option>
                                <option value="short">Short</option>
                            </optgroup>
                            <optgroup label="Nature & Organic">
                                <option value="birds">Birds</option>
                                <option value="birds3">Birds 3</option>
                                <option value="bubble">Bubble</option>
                                <option value="crow">Crow</option>
                                <option value="fire">Fire</option>
                                <option value="insect">Insect</option>
                                <option value="pebbles">Pebbles</option>
                            </optgroup>
                            <optgroup label="World & Ethnic">
                                <option value="east">East</option>
                                <option value="latibro">Latibro</option>
                                <option value="sundance">Sundance</option>
                                <option value="world">World</option>
                            </optgroup>
                            <optgroup label="Weird & Experimental">
                                <option value="ab">AB</option>
                                <option value="ade">Ade</option>
                                <option value="ades2">Ades 2</option>
                                <option value="ades3">Ades 3</option>
                                <option value="ades4">Ades 4</option>
                                <option value="alex">Alex</option>
                                <option value="armora">Armora</option>
                                <option value="baa">Baa</option>
                                <option value="baa2">Baa 2</option>
                                <option value="battles">Battles</option>
                                <option value="bev">Bev</option>
                                <option value="bin">Bin</option>
                                <option value="blue">Blue</option>
                                <option value="cb">CB</option>
                                <option value="cc">CC</option>
                                <option value="chin">Chin</option>
                                <option value="circus">Circus</option>
                                <option value="clak">Clak</option>
                                <option value="co">CO</option>
                                <option value="coins">Coins</option>
                                <option value="cr">CR</option>
                                <option value="d">D</option>
                                <option value="dork2">Dork 2</option>
                                <option value="e">E</option>
                                <option value="erk">Erk</option>
                                <option value="f">F</option>
                                <option value="fest">Fest</option>
                                <option value="h">H</option>
                                <option value="hc">HC</option>
                                <option value="hit">Hit</option>
                                <option value="ht">HT</option>
                                <option value="incoming">Incoming</option>
                                <option value="invaders">Invaders</option>
                                <option value="koy">Koy</option>
                                <option value="kurt">Kurt</option>
                                <option value="led">LED</option>
                                <option value="less">Less</option>
                                <option value="lt">LT</option>
                                <option value="made">Made</option>
                                <option value="made2">Made 2</option>
                                <option value="mash">Mash</option>
                                <option value="mash2">Mash 2</option>
                                <option value="mp3">MP3</option>
                                <option value="msg">MSG</option>
                                <option value="mt">MT</option>
                                <option value="odx">ODX</option>
                                <option value="realclaps">Real Claps</option>
                                <option value="rm">RM</option>
                                <option value="rs">RS</option>
                                <option value="sf">SF</option>
                                <option value="sheffield">Sheffield</option>
                                <option value="speedupdown">Speed Up/Down</option>
                                <option value="tacscan">Tacscan</option>
                                <option value="toys">Toys</option>
                                <option value="ulgab">Ulgab</option>
                                <option value="uxay">Uxay</option>
                                <option value="v">V</option>
                                <option value="voodoo">Voodoo</option>
                                <option value="xmas">Xmas</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="shader-selector dirt-controls" style="display: none;">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                            </svg>
                            Lead Samples
                        </label>
                        <select id="dirtLeadBank">
                            <optgroup label="Pads & Ambient">
                                <option value="breath">Breath</option>
                                <option value="cosmicg">Cosmicg</option>
                                <option value="feel">Feel</option>
                                <option value="feelfx">Feelfx</option>
                                <option value="moog">Moog</option>
                                <option value="newnotes">Newnotes</option>
                                <option value="notes">Notes</option>
                                <option value="outdoor">Outdoor</option>
                                <option value="pad">Pad</option>
                                <option value="padlong">Padlong</option>
                                <option value="psr">PSR</option>
                                <option value="seawolf">Seawolf</option>
                                <option value="space">Space</option>
                                <option value="sugar">Sugar</option>
                                <option value="wind">Wind</option>
                            </optgroup>
                            <optgroup label="Bass">
                                <option value="bass">Bass</option>
                                <option value="bass0">Bass 0</option>
                                <option value="bass1">Bass 1</option>
                                <option value="bass2">Bass 2</option>
                                <option value="bass3">Bass 3</option>
                                <option value="bassfoo">Bassfoo</option>
                                <option value="db">Double Bass</option>
                                <option value="dorkbot">Dorkbot</option>
                                <option value="jungbass">Jungle Bass</option>
                                <option value="jvbass">JV Bass</option>
                                <option value="subroc3d">Subroc3D</option>
                                <option value="wobble">Wobble</option>
                            </optgroup>
                            <optgroup label="Leads & Melodic">
                                <option value="arpy" selected>Arpy</option>
                                <option value="bleep">Bleep</option>
                                <option value="gtr">Guitar</option>
                                <option value="hoover">Hoover</option>
                                <option value="monsterb">Monsterb</option>
                                <option value="oc">OC</option>
                                <option value="popkick">Popkick</option>
                                <option value="sax">Sax</option>
                                <option value="simplesine">Simple Sine</option>
                                <option value="trump">Trumpet</option>
                                <option value="ul">UL</option>
                            </optgroup>
                            <optgroup label="Plucks & Keys">
                                <option value="arp">Arp</option>
                                <option value="blip">Blip</option>
                                <option value="bottle">Bottle</option>
                                <option value="casio">Casio</option>
                                <option value="click">Click</option>
                                <option value="jazz">Jazz</option>
                                <option value="juno">Juno</option>
                                <option value="peri">Peri</option>
                                <option value="pluck">Pluck</option>
                                <option value="print">Print</option>
                                <option value="sitar">Sitar</option>
                                <option value="stab">Stab</option>
                            </optgroup>
                            <optgroup label="Percussion">
                                <option value="can">Can</option>
                                <option value="glasstap">Glasstap</option>
                                <option value="hand">Hand</option>
                                <option value="lighter">Lighter</option>
                                <option value="metal">Metal</option>
                                <option value="perc">Perc</option>
                                <option value="stomp">Stomp</option>
                                <option value="tabla">Tabla</option>
                                <option value="tabla2">Tabla 2</option>
                                <option value="tablex">Tablex</option>
                                <option value="tink">Tink</option>
                                <option value="tok">Tok</option>
                            </optgroup>
                            <optgroup label="Drums & Breaks">
                                <option value="amencutup">Amen Cutup</option>
                                <option value="bd">Bass Drum</option>
                                <option value="breaks125">Breaks 125</option>
                                <option value="clubkick">Club Kick</option>
                                <option value="cp">Clap</option>
                                <option value="dr55">DR-55</option>
                                <option value="drum">Drum</option>
                                <option value="drumtraks">Drumtraks</option>
                                <option value="gretsch">Gretsch</option>
                                <option value="hardkick">Hard Kick</option>
                                <option value="hh">Hi-hat</option>
                                <option value="hh27">Hi-hat 27</option>
                                <option value="jungle">Jungle</option>
                                <option value="kicklinn">Kick Linn</option>
                                <option value="linnhats">Linn Hats</option>
                                <option value="reverbkick">Reverb Kick</option>
                                <option value="sd">Snare Drum</option>
                                <option value="sn">Snare</option>
                            </optgroup>
                            <optgroup label="Electronic & Synth">
                                <option value="auto">Auto</option>
                                <option value="electro1">Electro 1</option>
                                <option value="em2">EM2</option>
                                <option value="fm">FM</option>
                                <option value="future">Future</option>
                                <option value="gabba">Gabba</option>
                                <option value="gabbaloud">Gabba Loud</option>
                                <option value="gabbalouder">Gabba Louder</option>
                                <option value="hardcore">Hardcore</option>
                                <option value="house">House</option>
                                <option value="rave">Rave</option>
                                <option value="rave2">Rave 2</option>
                                <option value="ravemono">Rave Mono</option>
                                <option value="sequential">Sequential</option>
                                <option value="sid">SID</option>
                                <option value="tech">Tech</option>
                                <option value="techno">Techno</option>
                            </optgroup>
                            <optgroup label="Vocals & Speech">
                                <option value="alphabet">Alphabet</option>
                                <option value="diphone">Diphone</option>
                                <option value="diphone2">Diphone 2</option>
                                <option value="haw">Haw</option>
                                <option value="hmm">Hmm</option>
                                <option value="ho">Ho</option>
                                <option value="miniyeah">Mini Yeah</option>
                                <option value="mouth">Mouth</option>
                                <option value="num">Num</option>
                                <option value="numbers">Numbers</option>
                                <option value="speakspell">Speak & Spell</option>
                                <option value="speech">Speech</option>
                                <option value="speechless">Speechless</option>
                                <option value="yeah">Yeah</option>
                            </optgroup>
                            <optgroup label="FX & Glitch">
                                <option value="bend">Bend</option>
                                <option value="control">Control</option>
                                <option value="dist">Distortion</option>
                                <option value="flick">Flick</option>
                                <option value="foo">Foo</option>
                                <option value="gab">Gab</option>
                                <option value="glitch">Glitch</option>
                                <option value="glitch2">Glitch 2</option>
                                <option value="if">If</option>
                                <option value="ifdrums">If Drums</option>
                                <option value="industrial">Industrial</option>
                                <option value="mute">Mute</option>
                                <option value="noise">Noise</option>
                                <option value="noise2">Noise 2</option>
                                <option value="off">Off</option>
                                <option value="proc">Proc</option>
                                <option value="procshort">Proc Short</option>
                                <option value="short">Short</option>
                            </optgroup>
                            <optgroup label="Nature & Organic">
                                <option value="birds">Birds</option>
                                <option value="birds3">Birds 3</option>
                                <option value="bubble">Bubble</option>
                                <option value="crow">Crow</option>
                                <option value="fire">Fire</option>
                                <option value="insect">Insect</option>
                                <option value="pebbles">Pebbles</option>
                            </optgroup>
                            <optgroup label="World & Ethnic">
                                <option value="east">East</option>
                                <option value="latibro">Latibro</option>
                                <option value="sundance">Sundance</option>
                                <option value="world">World</option>
                            </optgroup>
                            <optgroup label="Weird & Experimental">
                                <option value="ab">AB</option>
                                <option value="ade">Ade</option>
                                <option value="ades2">Ades 2</option>
                                <option value="ades3">Ades 3</option>
                                <option value="ades4">Ades 4</option>
                                <option value="alex">Alex</option>
                                <option value="armora">Armora</option>
                                <option value="baa">Baa</option>
                                <option value="baa2">Baa 2</option>
                                <option value="battles">Battles</option>
                                <option value="bev">Bev</option>
                                <option value="bin">Bin</option>
                                <option value="blue">Blue</option>
                                <option value="cb">CB</option>
                                <option value="cc">CC</option>
                                <option value="chin">Chin</option>
                                <option value="circus">Circus</option>
                                <option value="clak">Clak</option>
                                <option value="co">CO</option>
                                <option value="coins">Coins</option>
                                <option value="cr">CR</option>
                                <option value="d">D</option>
                                <option value="dork2">Dork 2</option>
                                <option value="e">E</option>
                                <option value="erk">Erk</option>
                                <option value="f">F</option>
                                <option value="fest">Fest</option>
                                <option value="h">H</option>
                                <option value="hc">HC</option>
                                <option value="hit">Hit</option>
                                <option value="ht">HT</option>
                                <option value="incoming">Incoming</option>
                                <option value="invaders">Invaders</option>
                                <option value="koy">Koy</option>
                                <option value="kurt">Kurt</option>
                                <option value="led">LED</option>
                                <option value="less">Less</option>
                                <option value="lt">LT</option>
                                <option value="made">Made</option>
                                <option value="made2">Made 2</option>
                                <option value="mash">Mash</option>
                                <option value="mash2">Mash 2</option>
                                <option value="mp3">MP3</option>
                                <option value="msg">MSG</option>
                                <option value="mt">MT</option>
                                <option value="odx">ODX</option>
                                <option value="realclaps">Real Claps</option>
                                <option value="rm">RM</option>
                                <option value="rs">RS</option>
                                <option value="sf">SF</option>
                                <option value="sheffield">Sheffield</option>
                                <option value="speedupdown">Speed Up/Down</option>
                                <option value="tacscan">Tacscan</option>
                                <option value="toys">Toys</option>
                                <option value="ulgab">Ulgab</option>
                                <option value="uxay">Uxay</option>
                                <option value="v">V</option>
                                <option value="voodoo">Voodoo</option>
                                <option value="xmas">Xmas</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="shader-selector dirt-controls" style="display: none;">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                            </svg>
                            Bass Samples
                        </label>
                        <select id="dirtBassBank">
                            <optgroup label="Pads & Ambient">
                                <option value="breath">Breath</option>
                                <option value="cosmicg">Cosmicg</option>
                                <option value="feel">Feel</option>
                                <option value="feelfx">Feelfx</option>
                                <option value="moog">Moog</option>
                                <option value="newnotes">Newnotes</option>
                                <option value="notes">Notes</option>
                                <option value="outdoor">Outdoor</option>
                                <option value="pad">Pad</option>
                                <option value="padlong">Padlong</option>
                                <option value="psr">PSR</option>
                                <option value="seawolf">Seawolf</option>
                                <option value="space">Space</option>
                                <option value="sugar">Sugar</option>
                                <option value="wind">Wind</option>
                            </optgroup>
                            <optgroup label="Bass">
                                <option value="bass" selected>Bass</option>
                                <option value="bass0">Bass 0</option>
                                <option value="bass1">Bass 1</option>
                                <option value="bass2">Bass 2</option>
                                <option value="bass3">Bass 3</option>
                                <option value="bassfoo">Bassfoo</option>
                                <option value="db">Double Bass</option>
                                <option value="dorkbot">Dorkbot</option>
                                <option value="jungbass">Jungle Bass</option>
                                <option value="jvbass">JV Bass</option>
                                <option value="subroc3d">Subroc3D</option>
                                <option value="wobble">Wobble</option>
                            </optgroup>
                            <optgroup label="Leads & Melodic">
                                <option value="arpy">Arpy</option>
                                <option value="bleep">Bleep</option>
                                <option value="gtr">Guitar</option>
                                <option value="hoover">Hoover</option>
                                <option value="monsterb">Monsterb</option>
                                <option value="oc">OC</option>
                                <option value="popkick">Popkick</option>
                                <option value="sax">Sax</option>
                                <option value="simplesine">Simple Sine</option>
                                <option value="trump">Trumpet</option>
                                <option value="ul">UL</option>
                            </optgroup>
                            <optgroup label="Plucks & Keys">
                                <option value="arp">Arp</option>
                                <option value="blip">Blip</option>
                                <option value="bottle">Bottle</option>
                                <option value="casio">Casio</option>
                                <option value="click">Click</option>
                                <option value="jazz">Jazz</option>
                                <option value="juno">Juno</option>
                                <option value="peri">Peri</option>
                                <option value="pluck">Pluck</option>
                                <option value="print">Print</option>
                                <option value="sitar">Sitar</option>
                                <option value="stab">Stab</option>
                            </optgroup>
                            <optgroup label="Percussion">
                                <option value="can">Can</option>
                                <option value="glasstap">Glasstap</option>
                                <option value="hand">Hand</option>
                                <option value="lighter">Lighter</option>
                                <option value="metal">Metal</option>
                                <option value="perc">Perc</option>
                                <option value="stomp">Stomp</option>
                                <option value="tabla">Tabla</option>
                                <option value="tabla2">Tabla 2</option>
                                <option value="tablex">Tablex</option>
                                <option value="tink">Tink</option>
                                <option value="tok">Tok</option>
                            </optgroup>
                            <optgroup label="Drums & Breaks">
                                <option value="amencutup">Amen Cutup</option>
                                <option value="bd">Bass Drum</option>
                                <option value="breaks125">Breaks 125</option>
                                <option value="clubkick">Club Kick</option>
                                <option value="cp">Clap</option>
                                <option value="dr55">DR-55</option>
                                <option value="drum">Drum</option>
                                <option value="drumtraks">Drumtraks</option>
                                <option value="gretsch">Gretsch</option>
                                <option value="hardkick">Hard Kick</option>
                                <option value="hh">Hi-hat</option>
                                <option value="hh27">Hi-hat 27</option>
                                <option value="jungle">Jungle</option>
                                <option value="kicklinn">Kick Linn</option>
                                <option value="linnhats">Linn Hats</option>
                                <option value="reverbkick">Reverb Kick</option>
                                <option value="sd">Snare Drum</option>
                                <option value="sn">Snare</option>
                            </optgroup>
                            <optgroup label="Electronic & Synth">
                                <option value="auto">Auto</option>
                                <option value="electro1">Electro 1</option>
                                <option value="em2">EM2</option>
                                <option value="fm">FM</option>
                                <option value="future">Future</option>
                                <option value="gabba">Gabba</option>
                                <option value="gabbaloud">Gabba Loud</option>
                                <option value="gabbalouder">Gabba Louder</option>
                                <option value="hardcore">Hardcore</option>
                                <option value="house">House</option>
                                <option value="rave">Rave</option>
                                <option value="rave2">Rave 2</option>
                                <option value="ravemono">Rave Mono</option>
                                <option value="sequential">Sequential</option>
                                <option value="sid">SID</option>
                                <option value="tech">Tech</option>
                                <option value="techno">Techno</option>
                            </optgroup>
                            <optgroup label="Vocals & Speech">
                                <option value="alphabet">Alphabet</option>
                                <option value="diphone">Diphone</option>
                                <option value="diphone2">Diphone 2</option>
                                <option value="haw">Haw</option>
                                <option value="hmm">Hmm</option>
                                <option value="ho">Ho</option>
                                <option value="miniyeah">Mini Yeah</option>
                                <option value="mouth">Mouth</option>
                                <option value="num">Num</option>
                                <option value="numbers">Numbers</option>
                                <option value="speakspell">Speak & Spell</option>
                                <option value="speech">Speech</option>
                                <option value="speechless">Speechless</option>
                                <option value="yeah">Yeah</option>
                            </optgroup>
                            <optgroup label="FX & Glitch">
                                <option value="bend">Bend</option>
                                <option value="control">Control</option>
                                <option value="dist">Distortion</option>
                                <option value="flick">Flick</option>
                                <option value="foo">Foo</option>
                                <option value="gab">Gab</option>
                                <option value="glitch">Glitch</option>
                                <option value="glitch2">Glitch 2</option>
                                <option value="if">If</option>
                                <option value="ifdrums">If Drums</option>
                                <option value="industrial">Industrial</option>
                                <option value="mute">Mute</option>
                                <option value="noise">Noise</option>
                                <option value="noise2">Noise 2</option>
                                <option value="off">Off</option>
                                <option value="proc">Proc</option>
                                <option value="procshort">Proc Short</option>
                                <option value="short">Short</option>
                            </optgroup>
                            <optgroup label="Nature & Organic">
                                <option value="birds">Birds</option>
                                <option value="birds3">Birds 3</option>
                                <option value="bubble">Bubble</option>
                                <option value="crow">Crow</option>
                                <option value="fire">Fire</option>
                                <option value="insect">Insect</option>
                                <option value="pebbles">Pebbles</option>
                            </optgroup>
                            <optgroup label="World & Ethnic">
                                <option value="east">East</option>
                                <option value="latibro">Latibro</option>
                                <option value="sundance">Sundance</option>
                                <option value="world">World</option>
                            </optgroup>
                            <optgroup label="Weird & Experimental">
                                <option value="ab">AB</option>
                                <option value="ade">Ade</option>
                                <option value="ades2">Ades 2</option>
                                <option value="ades3">Ades 3</option>
                                <option value="ades4">Ades 4</option>
                                <option value="alex">Alex</option>
                                <option value="armora">Armora</option>
                                <option value="baa">Baa</option>
                                <option value="baa2">Baa 2</option>
                                <option value="battles">Battles</option>
                                <option value="bev">Bev</option>
                                <option value="bin">Bin</option>
                                <option value="blue">Blue</option>
                                <option value="cb">CB</option>
                                <option value="cc">CC</option>
                                <option value="chin">Chin</option>
                                <option value="circus">Circus</option>
                                <option value="clak">Clak</option>
                                <option value="co">CO</option>
                                <option value="coins">Coins</option>
                                <option value="cr">CR</option>
                                <option value="d">D</option>
                                <option value="dork2">Dork 2</option>
                                <option value="e">E</option>
                                <option value="erk">Erk</option>
                                <option value="f">F</option>
                                <option value="fest">Fest</option>
                                <option value="h">H</option>
                                <option value="hc">HC</option>
                                <option value="hit">Hit</option>
                                <option value="ht">HT</option>
                                <option value="incoming">Incoming</option>
                                <option value="invaders">Invaders</option>
                                <option value="koy">Koy</option>
                                <option value="kurt">Kurt</option>
                                <option value="led">LED</option>
                                <option value="less">Less</option>
                                <option value="lt">LT</option>
                                <option value="made">Made</option>
                                <option value="made2">Made 2</option>
                                <option value="mash">Mash</option>
                                <option value="mash2">Mash 2</option>
                                <option value="mp3">MP3</option>
                                <option value="msg">MSG</option>
                                <option value="mt">MT</option>
                                <option value="odx">ODX</option>
                                <option value="realclaps">Real Claps</option>
                                <option value="rm">RM</option>
                                <option value="rs">RS</option>
                                <option value="sf">SF</option>
                                <option value="sheffield">Sheffield</option>
                                <option value="speedupdown">Speed Up/Down</option>
                                <option value="tacscan">Tacscan</option>
                                <option value="toys">Toys</option>
                                <option value="ulgab">Ulgab</option>
                                <option value="uxay">Uxay</option>
                                <option value="v">V</option>
                                <option value="voodoo">Voodoo</option>
                                <option value="xmas">Xmas</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="shader-selector dirt-controls" style="display: none;">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                            </svg>
                            Arp Samples
                        </label>
                        <select id="dirtArpBank">
                            <optgroup label="Pads & Ambient">
                                <option value="breath">Breath</option>
                                <option value="cosmicg">Cosmicg</option>
                                <option value="feel">Feel</option>
                                <option value="feelfx">Feelfx</option>
                                <option value="moog">Moog</option>
                                <option value="newnotes">Newnotes</option>
                                <option value="notes">Notes</option>
                                <option value="outdoor">Outdoor</option>
                                <option value="pad">Pad</option>
                                <option value="padlong">Padlong</option>
                                <option value="psr">PSR</option>
                                <option value="seawolf">Seawolf</option>
                                <option value="space">Space</option>
                                <option value="sugar">Sugar</option>
                                <option value="wind">Wind</option>
                            </optgroup>
                            <optgroup label="Bass">
                                <option value="bass">Bass</option>
                                <option value="bass0">Bass 0</option>
                                <option value="bass1">Bass 1</option>
                                <option value="bass2">Bass 2</option>
                                <option value="bass3">Bass 3</option>
                                <option value="bassfoo">Bassfoo</option>
                                <option value="db">Double Bass</option>
                                <option value="dorkbot">Dorkbot</option>
                                <option value="jungbass">Jungle Bass</option>
                                <option value="jvbass">JV Bass</option>
                                <option value="subroc3d">Subroc3D</option>
                                <option value="wobble">Wobble</option>
                            </optgroup>
                            <optgroup label="Leads & Melodic">
                                <option value="arpy">Arpy</option>
                                <option value="bleep">Bleep</option>
                                <option value="gtr">Guitar</option>
                                <option value="hoover">Hoover</option>
                                <option value="monsterb">Monsterb</option>
                                <option value="oc">OC</option>
                                <option value="popkick">Popkick</option>
                                <option value="sax">Sax</option>
                                <option value="simplesine">Simple Sine</option>
                                <option value="trump">Trumpet</option>
                                <option value="ul">UL</option>
                            </optgroup>
                            <optgroup label="Plucks & Keys">
                                <option value="arp">Arp</option>
                                <option value="blip">Blip</option>
                                <option value="bottle">Bottle</option>
                                <option value="casio">Casio</option>
                                <option value="click">Click</option>
                                <option value="jazz">Jazz</option>
                                <option value="juno">Juno</option>
                                <option value="peri">Peri</option>
                                <option value="pluck" selected>Pluck</option>
                                <option value="print">Print</option>
                                <option value="sitar">Sitar</option>
                                <option value="stab">Stab</option>
                            </optgroup>
                            <optgroup label="Percussion">
                                <option value="can">Can</option>
                                <option value="glasstap">Glasstap</option>
                                <option value="hand">Hand</option>
                                <option value="lighter">Lighter</option>
                                <option value="metal">Metal</option>
                                <option value="perc">Perc</option>
                                <option value="stomp">Stomp</option>
                                <option value="tabla">Tabla</option>
                                <option value="tabla2">Tabla 2</option>
                                <option value="tablex">Tablex</option>
                                <option value="tink">Tink</option>
                                <option value="tok">Tok</option>
                            </optgroup>
                            <optgroup label="Drums & Breaks">
                                <option value="amencutup">Amen Cutup</option>
                                <option value="bd">Bass Drum</option>
                                <option value="breaks125">Breaks 125</option>
                                <option value="clubkick">Club Kick</option>
                                <option value="cp">Clap</option>
                                <option value="dr55">DR-55</option>
                                <option value="drum">Drum</option>
                                <option value="drumtraks">Drumtraks</option>
                                <option value="gretsch">Gretsch</option>
                                <option value="hardkick">Hard Kick</option>
                                <option value="hh">Hi-hat</option>
                                <option value="hh27">Hi-hat 27</option>
                                <option value="jungle">Jungle</option>
                                <option value="kicklinn">Kick Linn</option>
                                <option value="linnhats">Linn Hats</option>
                                <option value="reverbkick">Reverb Kick</option>
                                <option value="sd">Snare Drum</option>
                                <option value="sn">Snare</option>
                            </optgroup>
                            <optgroup label="Electronic & Synth">
                                <option value="auto">Auto</option>
                                <option value="electro1">Electro 1</option>
                                <option value="em2">EM2</option>
                                <option value="fm">FM</option>
                                <option value="future">Future</option>
                                <option value="gabba">Gabba</option>
                                <option value="gabbaloud">Gabba Loud</option>
                                <option value="gabbalouder">Gabba Louder</option>
                                <option value="hardcore">Hardcore</option>
                                <option value="house">House</option>
                                <option value="rave">Rave</option>
                                <option value="rave2">Rave 2</option>
                                <option value="ravemono">Rave Mono</option>
                                <option value="sequential">Sequential</option>
                                <option value="sid">SID</option>
                                <option value="tech">Tech</option>
                                <option value="techno">Techno</option>
                            </optgroup>
                            <optgroup label="Vocals & Speech">
                                <option value="alphabet">Alphabet</option>
                                <option value="diphone">Diphone</option>
                                <option value="diphone2">Diphone 2</option>
                                <option value="haw">Haw</option>
                                <option value="hmm">Hmm</option>
                                <option value="ho">Ho</option>
                                <option value="miniyeah">Mini Yeah</option>
                                <option value="mouth">Mouth</option>
                                <option value="num">Num</option>
                                <option value="numbers">Numbers</option>
                                <option value="speakspell">Speak & Spell</option>
                                <option value="speech">Speech</option>
                                <option value="speechless">Speechless</option>
                                <option value="yeah">Yeah</option>
                            </optgroup>
                            <optgroup label="FX & Glitch">
                                <option value="bend">Bend</option>
                                <option value="control">Control</option>
                                <option value="dist">Distortion</option>
                                <option value="flick">Flick</option>
                                <option value="foo">Foo</option>
                                <option value="gab">Gab</option>
                                <option value="glitch">Glitch</option>
                                <option value="glitch2">Glitch 2</option>
                                <option value="if">If</option>
                                <option value="ifdrums">If Drums</option>
                                <option value="industrial">Industrial</option>
                                <option value="mute">Mute</option>
                                <option value="noise">Noise</option>
                                <option value="noise2">Noise 2</option>
                                <option value="off">Off</option>
                                <option value="proc">Proc</option>
                                <option value="procshort">Proc Short</option>
                                <option value="short">Short</option>
                            </optgroup>
                            <optgroup label="Nature & Organic">
                                <option value="birds">Birds</option>
                                <option value="birds3">Birds 3</option>
                                <option value="bubble">Bubble</option>
                                <option value="crow">Crow</option>
                                <option value="fire">Fire</option>
                                <option value="insect">Insect</option>
                                <option value="pebbles">Pebbles</option>
                            </optgroup>
                            <optgroup label="World & Ethnic">
                                <option value="east">East</option>
                                <option value="latibro">Latibro</option>
                                <option value="sundance">Sundance</option>
                                <option value="world">World</option>
                            </optgroup>
                            <optgroup label="Weird & Experimental">
                                <option value="ab">AB</option>
                                <option value="ade">Ade</option>
                                <option value="ades2">Ades 2</option>
                                <option value="ades3">Ades 3</option>
                                <option value="ades4">Ades 4</option>
                                <option value="alex">Alex</option>
                                <option value="armora">Armora</option>
                                <option value="baa">Baa</option>
                                <option value="baa2">Baa 2</option>
                                <option value="battles">Battles</option>
                                <option value="bev">Bev</option>
                                <option value="bin">Bin</option>
                                <option value="blue">Blue</option>
                                <option value="cb">CB</option>
                                <option value="cc">CC</option>
                                <option value="chin">Chin</option>
                                <option value="circus">Circus</option>
                                <option value="clak">Clak</option>
                                <option value="co">CO</option>
                                <option value="coins">Coins</option>
                                <option value="cr">CR</option>
                                <option value="d">D</option>
                                <option value="dork2">Dork 2</option>
                                <option value="e">E</option>
                                <option value="erk">Erk</option>
                                <option value="f">F</option>
                                <option value="fest">Fest</option>
                                <option value="h">H</option>
                                <option value="hc">HC</option>
                                <option value="hit">Hit</option>
                                <option value="ht">HT</option>
                                <option value="incoming">Incoming</option>
                                <option value="invaders">Invaders</option>
                                <option value="koy">Koy</option>
                                <option value="kurt">Kurt</option>
                                <option value="led">LED</option>
                                <option value="less">Less</option>
                                <option value="lt">LT</option>
                                <option value="made">Made</option>
                                <option value="made2">Made 2</option>
                                <option value="mash">Mash</option>
                                <option value="mash2">Mash 2</option>
                                <option value="mp3">MP3</option>
                                <option value="msg">MSG</option>
                                <option value="mt">MT</option>
                                <option value="odx">ODX</option>
                                <option value="realclaps">Real Claps</option>
                                <option value="rm">RM</option>
                                <option value="rs">RS</option>
                                <option value="sf">SF</option>
                                <option value="sheffield">Sheffield</option>
                                <option value="speedupdown">Speed Up/Down</option>
                                <option value="tacscan">Tacscan</option>
                                <option value="toys">Toys</option>
                                <option value="ulgab">Ulgab</option>
                                <option value="uxay">Uxay</option>
                                <option value="v">V</option>
                                <option value="voodoo">Voodoo</option>
                                <option value="xmas">Xmas</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2l-5.5 9h11L12 2zm0 3.84L13.93 9h-3.87L12 5.84zM17.5 13c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5zm0 7c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM3 21.5h8v-8H3v8zm2-6h4v4H5v-4z"/>
                            </svg>
                            Musical Scale
                        </label>
                        <select id="scaleSelect">
                            <option value="minor" selected>Minor (Natural)</option>
                            <option value="major">Major</option>
                            <option value="pentatonic">Pentatonic</option>
                            <option value="dorian">Dorian</option>
                            <option value="phrygian">Phrygian</option>
                        </select>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                            </svg>
                            Song Key (Root Note)
                        </label>
                        <select id="keySelect">
                            <option value="C2">C2 (Low)</option>
                            <option value="C#2">C#2 / Db2</option>
                            <option value="D2">D2</option>
                            <option value="D#2">D#2 / Eb2</option>
                            <option value="E2">E2</option>
                            <option value="F2">F2</option>
                            <option value="F#2">F#2 / Gb2</option>
                            <option value="G2">G2</option>
                            <option value="G#2">G#2 / Ab2</option>
                            <option value="A2">A2</option>
                            <option value="A#2">A#2 / Bb2</option>
                            <option value="B2">B2</option>
                            <option value="C3" selected>C3 (Default)</option>
                            <option value="C#3">C#3 / Db3</option>
                            <option value="D3">D3</option>
                            <option value="D#3">D#3 / Eb3</option>
                            <option value="E3">E3</option>
                            <option value="F3">F3</option>
                            <option value="F#3">F#3 / Gb3</option>
                            <option value="G3">G3</option>
                            <option value="G#3">G#3 / Ab3</option>
                            <option value="A3">A3</option>
                            <option value="A#3">A#3 / Bb3</option>
                            <option value="B3">B3</option>
                            <option value="C4">C4 (Middle C)</option>
                            <option value="C#4">C#4 / Db4</option>
                            <option value="D4">D4</option>
                            <option value="D#4">D#4 / Eb4</option>
                            <option value="E4">E4</option>
                            <option value="F4">F4</option>
                            <option value="F#4">F#4 / Gb4</option>
                            <option value="G4">G4</option>
                            <option value="G#4">G#4 / Ab4</option>
                            <option value="A4">A4 (440Hz)</option>
                            <option value="A#4">A#4 / Bb4</option>
                            <option value="B4">B4</option>
                        </select>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/>
                            </svg>
                            Reverb Type
                        </label>
                        <select id="reverbTypeSelect">
                            <option value="hall" selected>Hall</option>
                            <option value="room">Room</option>
                            <option value="plate">Plate</option>
                            <option value="spring">Spring</option>
                            <option value="chamber">Chamber</option>
                            <option value="cathedral">Cathedral</option>
                            <option value="none">None</option>
                        </select>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.5 12c0 2.49-2.01 4.5-4.5 4.5s-4.5-2.01-4.5-4.5 2.01-4.5 4.5-4.5 4.5 2.01 4.5 4.5zm-1.5 0c0-1.66-1.34-3-3-3s-3 1.34-3 3 1.34 3 3 3 3-1.34 3-3zm-3-7C7.48 5 2 8 2 12s5.48 7 11 7 11-3 11-7-5.48-7-11-7z"/>
                            </svg>
                            Delay Type
                        </label>
                        <select id="delayTypeSelect">
                            <option value="eighth" selected>1/8 Note</option>
                            <option value="quarter">1/4 Note</option>
                            <option value="dotted">Dotted 1/8</option>
                            <option value="slapback">Slapback</option>
                            <option value="pingpong">Ping-Pong</option>
                            <option value="tape">Tape Echo</option>
                            <option value="long">Long Delay</option>
                            <option value="none">None</option>
                        </select>
                    </div>
                    <div class="toggle-group">
                        <label class="toggle">
                            <input type="checkbox" id="drumsToggle">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">
                                <svg class="icon" viewBox="0 0 24 24" fill="currentColor" style="width: 16px; height: 16px; margin-right: 5px;">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h2v2H7zm8 0h2v2h-2zm-4 0h2v2h-2z"/>
                                </svg>
                                Drum Machine
                            </span>
                        </label>
                        <button id="openSequencerBtn" class="btn-secondary" style="margin-top: 10px; width: 100%;">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 5v14h18V5H3zm4 12H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V7h2v2zm4 8H9v-2h2v2zm0-4H9v-2h2v2zm0-4H9V7h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/>
                            </svg>
                            Pattern Editor
                        </button>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/>
                            </svg>
                            Drum Machine
                        </label>
                        <select id="drumMachineSelect">
                            <!-- Dynamically populated -->
                        </select>
                    </div>
                    <div class="shader-selector">
                        <label>
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                            </svg>
                            Drum Pattern
                        </label>
                        <select id="drumPatternSelect">
                            <!-- Dynamically populated -->
                        </select>
                    </div>
                </div>

                <div class="control-group">
                    <h3>Visuals</h3>
                    <div class="toggle-group">
                        <label class="toggle">
                            <input type="checkbox" id="mainToggle" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Main Layer</span>
                        </label>
                        <label class="toggle">
                            <input type="checkbox" id="toyToggle" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">ShaderToy Layer</span>
                        </label>
                    </div>
                    <div class="slider-group">
                        <label>
                            Main Layer Opacity: <span id="mainOpacityValue">100</span>%
                            <input type="range" id="mainOpacity" min="0" max="100" value="100" step="1">
                        </label>
                        <label>
                            ShaderToy Layer Opacity: <span id="toyOpacityValue">80</span>%
                            <input type="range" id="toyOpacity" min="0" max="100" value="80" step="1">
                        </label>
                    </div>
                    <div class="shader-selector">
                        <label>Main Shader</label>
                        <select id="mainShaderSelect">
                            <optgroup label="Original">
                                <option value="0">Organic Raymarcher</option>
                                <option value="1">Fractal Tunnel</option>
                                <option value="2">Plasma Field</option>
                            </optgroup>
                            <optgroup label="Presets">
                                <option value="3">Voronoi Cells</option>
                                <option value="4">Mandelbrot Zoom</option>
                                <option value="5">Liquid Metal</option>
                                <option value="6">DNA Helix</option>
                                <option value="7">Grid Waves</option>
                            </optgroup>
                            <optgroup label="OSMOS Style">
                                <option value="8">‚ú® Glowing Orbs</option>
                                <option value="9">‚ú® Ethereal Flow</option>
                                <option value="10">‚ú® Cosmic Dust</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="shader-selector">
                        <label>Toy Shader</label>
                        <select id="toyShaderSelect">
                            <optgroup label="Original">
                                <option value="0">Audio Waves</option>
                                <option value="1">Particle Storm</option>
                                <option value="2">Kaleidoscope</option>
                            </optgroup>
                            <optgroup label="Presets">
                                <option value="3">Neon Rings</option>
                                <option value="4">Spiral Galaxy</option>
                                <option value="5">Glitch Art</option>
                                <option value="6">Hex Grid</option>
                                <option value="7">Sound Bars</option>
                            </optgroup>
                            <optgroup label="OSMOS Style">
                                <option value="8">‚ú® Ambient Motes</option>
                                <option value="9">‚ú® Aurora Waves</option>
                                <option value="10">‚ú® Dreamy Bokeh</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <div class="control-group">
                    <h3>System</h3>
                    <button id="mpcToggleBtn" class="btn-secondary">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4 6h4v4H4V6zm0 8h4v4H4v-4zm6-8h4v4h-4V6zm0 8h4v4h-4v-4zm6-8h4v4h-4V6zm0 8h4v4h-4v-4z"/>
                        </svg>
                        Show MPC Pads
                    </button>
                    <button id="synthSeqToggleBtn" class="btn-secondary">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                        </svg>
                        Show Synth Sequencer
                    </button>
                    <button id="fullscreenBtn" class="btn-secondary">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                        </svg>
                        Fullscreen
                    </button>
                    <div class="fps-meter">
                        <span>FPS: <span id="fpsValue">60</span></span>
                    </div>
                </div>
            </div>

            <!-- Audio Visualizer -->
            <div class="audio-viz">
                <canvas id="waveformCanvas"></canvas>
                <div class="freq-bars">
                    <div class="bar" id="barLow">
                        <div class="bar-fill"></div>
                        <span>LOW</span>
                    </div>
                    <div class="bar" id="barMid">
                        <div class="bar-fill"></div>
                        <span>MID</span>
                    </div>
                    <div class="bar" id="barHigh">
                        <div class="bar-fill"></div>
                        <span>HIGH</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating MPC Pad Controller -->
    <div id="mpcPanel" class="mpc-panel" style="display: none;">
        <div class="mpc-header" id="mpcHeader">
            <h3>
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 6h4v4H4V6zm0 8h4v4H4v-4zm6-8h4v4h-4V6zm0 8h4v4h-4v-4zm6-8h4v4h-4V6zm0 8h4v4h-4v-4z"/>
                </svg>
                MPC Pads
            </h3>
            <button id="mpcCloseBtn" class="mpc-close">√ó</button>
        </div>

        <div class="mpc-content">
            <div class="mpc-grid" id="mpcGrid">
                <!-- Row 1 - Drum Pads -->
                <button class="mpc-pad" data-pad="0" data-type="drum" data-pattern="">
                    <span class="pad-number">1</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="1" data-type="drum" data-pattern="">
                    <span class="pad-number">2</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="2" data-type="drum" data-pattern="">
                    <span class="pad-number">3</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="3" data-type="drum" data-pattern="">
                    <span class="pad-number">4</span>
                    <span class="pad-label">Empty</span>
                </button>

                <!-- Row 2 - Drum Pads -->
                <button class="mpc-pad" data-pad="4" data-type="drum" data-pattern="">
                    <span class="pad-number">5</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="5" data-type="drum" data-pattern="">
                    <span class="pad-number">6</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="6" data-type="drum" data-pattern="">
                    <span class="pad-number">7</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="7" data-type="drum" data-pattern="">
                    <span class="pad-number">8</span>
                    <span class="pad-label">Empty</span>
                </button>

                <!-- Row 3 - Synth Pads -->
                <button class="mpc-pad" data-pad="8" data-type="synth" data-pattern="">
                    <span class="pad-number">9</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="9" data-type="synth" data-pattern="">
                    <span class="pad-number">10</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="10" data-type="synth" data-pattern="">
                    <span class="pad-number">11</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="11" data-type="synth" data-pattern="">
                    <span class="pad-number">12</span>
                    <span class="pad-label">Empty</span>
                </button>

                <!-- Row 4 - Synth Pads -->
                <button class="mpc-pad" data-pad="12" data-type="synth" data-pattern="">
                    <span class="pad-number">13</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="13" data-type="synth" data-pattern="">
                    <span class="pad-number">14</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="14" data-type="synth" data-pattern="">
                    <span class="pad-number">15</span>
                    <span class="pad-label">Empty</span>
                </button>
                <button class="mpc-pad" data-pad="15" data-type="synth" data-pattern="">
                    <span class="pad-number">16</span>
                    <span class="pad-label">Empty</span>
                </button>
            </div>

            <div class="mpc-controls">
                <button id="mpcAssignMode" class="btn-secondary">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Assign Mode
                </button>
                <div class="mpc-assign-hint" id="mpcAssignHint" style="display: none;">
                    Click a pad, then select pattern to assign
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Synth Sequencer (Piano Roll) -->
    <div id="synthSequencer" class="synth-sequencer" style="display: none;">
        <div class="synth-seq-header" id="synthSeqHeader">
            <h3>
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                </svg>
                Synth Sequencer
            </h3>
            <button id="synthSeqCloseBtn" class="synth-seq-close">√ó</button>
        </div>

        <div class="synth-seq-content">
            <!-- Track Selector -->
            <div class="synth-seq-tracks">
                <button class="synth-track-btn active" data-track="pad">
                    <span class="track-icon">üéπ</span>
                    Pad
                </button>
                <button class="synth-track-btn" data-track="lead">
                    <span class="track-icon">üé∏</span>
                    Lead
                </button>
                <button class="synth-track-btn" data-track="bass">
                    <span class="track-icon">üîä</span>
                    Bass
                </button>
                <button class="synth-track-btn" data-track="arp">
                    <span class="track-icon">‚ú®</span>
                    Arp
                </button>
            </div>

            <!-- Piano Roll Container -->
            <div class="piano-roll-container">
                <!-- Piano Keys (Note labels) -->
                <div class="piano-keys" id="pianoKeys">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Step Grid -->
                <div class="piano-roll-wrapper">
                    <div class="piano-roll-grid" id="pianoRollGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="synth-seq-controls">
                <div class="control-row">
                    <button id="synthSeqPlay" class="btn-primary" title="Play Pattern">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        Play
                    </button>
                    <button id="synthSeqClear" class="btn-secondary" title="Clear Pattern">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                        Clear
                    </button>
                    <button id="synthSeqRandomize" class="btn-secondary" title="Randomize Pattern">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
                        </svg>
                        Random
                    </button>
                    <button id="synthSeqSave" class="btn-primary" title="Save Pattern">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                        </svg>
                        Save
                    </button>
                    <button id="synthSeqCopy" class="btn-secondary" title="Copy Pattern">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copy
                    </button>
                    <button id="synthSeqPaste" class="btn-secondary" title="Paste Pattern">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/>
                        </svg>
                        Paste
                    </button>
                    <div class="control-item" style="flex: 1; min-width: 200px;">
                        <label>Load Preset</label>
                        <select id="synthSeqPresetLoad">
                            <option value="">-- Select Pattern --</option>
                        </select>
                    </div>
                    <button id="synthSeqDelete" class="btn-secondary" title="Delete Selected Pattern">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                        </svg>
                        Delete
                    </button>
                </div>

                <div class="control-row">
                    <div class="control-item">
                        <label>Synth Engine</label>
                        <select id="synthSeqEngine">
                            <option value="tonejs" selected>Tone.js</option>
                            <option value="wad">WAD (Sound Banks)</option>
                            <option value="dirt">Dirt (Samples)</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>Length</label>
                        <select id="synthSeqLength">
                            <option value="8">8 steps</option>
                            <option value="16" selected>16 steps</option>
                            <option value="32">32 steps</option>
                            <option value="64">64 steps</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>Scale</label>
                        <select id="synthSeqScale">
                            <option value="chromatic">Chromatic</option>
                            <option value="major" selected>Major</option>
                            <option value="minor">Minor</option>
                            <option value="pentatonic">Pentatonic</option>
                            <option value="blues">Blues</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>Octave</label>
                        <select id="synthSeqOctave">
                            <option value="2">C2-B2</option>
                            <option value="3" selected>C3-B3</option>
                            <option value="4">C4-B4</option>
                            <option value="5">C5-B5</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>Velocity</label>
                        <input type="range" id="synthSeqVelocity" min="1" max="100" value="70">
                        <span id="synthSeqVelocityValue">70%</span>
                    </div>
                </div>

                <div class="control-row">
                    <button id="synthSeqExportMidi" class="btn-secondary" title="Export MIDI">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/>
                        </svg>
                        Export MIDI
                    </button>
                    <button id="synthSeqExportWav" class="btn-secondary" title="Export WAV">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/>
                        </svg>
                        Export WAV
                    </button>
                    <div class="pattern-info">
                        <span id="synthSeqPatternName">Current Pattern: <strong>Default</strong></span>
                        <span id="synthSeqKeyDisplay" style="margin-left: 20px;">Key: <strong>C Major</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Logger (must load first) -->
    <script src="src/debug.js"></script>

    <!-- Core Libraries - Local Tone.js with CDN fallback -->
    <script src="lib/tone.js"></script>
    <script>
        // Fallback to CDN if local Tone.js failed to load
        if (typeof Tone === 'undefined') {
            console.warn('‚ö†Ô∏è Local Tone.js failed, loading from CDN...');
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js';
            script.onerror = function() {
                console.error('‚ùå CDN Tone.js also failed to load!');
            };
            document.head.appendChild(script);
        } else {
            console.log('‚úÖ Tone.js loaded locally');
        }
    </script>

    <!-- Custom Modules -->
    <script src="lib/wad.min.js"></script>
    <script src="lib/shadertoy-lite.js"></script>
    <script src="src/visuals/osmos-shaders.js"></script>
    <script src="src/visuals/tron-shaders.js"></script>
    <script src="src/visuals/shadertoy-imports.js"></script>
    <script src="src/visuals/shader-presets.js"></script>
    <script src="src/visuals/main-shader.js"></script>
    <script src="src/visuals/toy-renderer.js"></script>
    <script src="src/audio/audio-engine.js"></script>
    <script src="src/audio/wad-synth-engine.js"></script>
    <script src="src/audio/dirt-sample-engine.js"></script>
    <script src="src/audio/generative-music.js"></script>
    <script src="src/visuals/shader-editor.js"></script>
    <script src="app.js"></script>

    <script>
        // Global error handler
        window.addEventListener('error', function(e) {
            if (window.DEBUG) {
                DEBUG.error('JS Error: ' + e.message);
            }
            console.error('Global error:', e);
        });

        // Unhandled promise rejection
        window.addEventListener('unhandledrejection', function(e) {
            if (window.DEBUG) {
                DEBUG.error('Promise Error: ' + e.reason);
            }
            console.error('Unhandled rejection:', e);
        });
    </script>
</body>
</html>
